<% if (tasks && tasks.length > 0) { %>
  <ul class="dynamic-columns list-gap-20 list-with-separator">
    <% tasks.forEach(task => { %>
      <%
        let priorityColor = '#969CB0'; // Default P1 Grey
        if (task.priority === 4) priorityColor = '#7cd0b0'; // P4 Red
        if (task.priority === 3) priorityColor = '#E5C890'; // P3 Orange
        if (task.priority === 2) priorityColor = '#8CAAEE'; // P3 Blue
      %>

      <li data-task-id="<%= task.id %>" class="flex items-center gap-15">
        <div class="min-width-0 grow">
          <div class="size-title-dynamic block text-truncate" style="color: <%= priorityColor %>;">
            <%= task.content %>
          </div>
          <div class="text-truncate">
            <% if (task.due && task.due.string) { %>
              Due: <%= task.due.string %>
            <% } else { %>
              Due: None
            <% } %>
          </div>
        </div>
        <button type="submit" onclick="fetch('http://glance-todoist/api/tasks/<%= task.id %>/close', { method: 'POST' }).then(res => { if(res.ok) { this.closest('li').remove(); } });"
            onmouseover="this.querySelector('.check-icon').style.display = 'block'; this.querySelector('.icon').style.display = 'none';"
            onmouseout="this.querySelector('.check-icon').style.display = 'none'; this.querySelector('.icon').style.display = 'block';"
            style="background: none; border: none; cursor: pointer; padding: 0; flex-shrink: 0; position: relative; width: 24px; height: 24px;">
          <svg class="check-icon" style="position: absolute; top: 0; left: 0; width: 24px; height: 24px; display: none" 
          xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="<%= priorityColor %>" stroke-width="2.5" stroke-linecap="round">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
          <svg class="icon" style="position: absolute; top: 0; left: 0; width: 24px; height: 24px; display: block" 
          xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="<%= priorityColor %>" stroke-width="2.5" stroke-linecap="round">
            <circle cx="12" cy="12" r="10"></svg>
          </svg>
        </button>
      </li>
    <% }); %>
  </ul>
<% } else { %>
  <p>No tasks found for this project.</p>
<% } %>
